.\" Manpage for da_dataset_prep (updated)
.TH DA_DATASET_PREP 1 "September 2025" "Digital Alexandria Tools" "User Commands"
.SH NAME
da_dataset_prep \- dataset preparation phase for Digital Alexandria prototype
.SH SYNOPSIS
.B da_dataset_prep.py
[\fB--input-root\fR \fIPATH\fR]
[\fB--blocks-root\fR \fIPATH\fR]
[\fB--qrcode-root\fR \fIPATH\fR]
[\fB--dna-root\fR \fIPATH\fR]
[\fB--protein-root\fR \fIPATH\fR]
[\fB--recipe-root\fR \fIPATH\fR]
[\fB--log-dir\fR \fIDIR\fR]
[\fB--chunk-size\fR \fIN\fR]
[\fB--file-workers\fR \fIN\fR]
[\fB--modality-workers\fR \fIN\fR]
[\fB--qr-version\fR \fIN\fR]
[\fB--qr-ecc\fR \fIL|M|Q|H\fR]
[\fB--no-qr\fR]
[\fB--no-dna\fR]
[\fB--no-protein\fR]
[\fB--verbose\fR]
.SH DESCRIPTION
The
.B da_dataset_prep
program implements Phase 1 of the Digital Alexandria pipeline.
It crawls a source directory of files and prepares data blocks,
recipes, and optional modality encodings for later archival.

For each source file:
.IP \(bu 2
Generates a process UUID and computes the file SHA\-256.
.IP \(bu 2
Splits the file into 1 KiB (or smaller) blocks, computes each blockâ€™s SHA\-256, and stores it in a deep pair\-tree directory under the
.B --blocks-root
directory.
.IP \(bu 2
If the block already exists, the program skips writing and modality generation.
.IP \(bu 2
For new blocks, optionally generates modalities:
    QR Code (Version 40, ECC H),
    DNA sequence,
    Protein sequence.
.IP \(bu 2
Creates a JSON
.B .recipe
file per source file with simplified block entries (sequence + SHA\-256 value) and a global
.B modality_options
section specifying root paths and modality flags.

Logging is INFO to console and DEBUG to a logfile under
.B --log-dir .

.SH OPTIONS
.TP
.BR --input-root " " \fIPATH\fR
Input directory containing source files.
Default:
.IR ./source .
.TP
.BR --blocks-root " " \fIPATH\fR
Root for storing block files in pair\-tree format.
Default:
.IR ./blocks .
.TP
.BR --qrcode-root " " \fIPATH\fR
Root for QR code outputs (.svg).
Default:
.IR /gpfs/Log/qr_proto/qrcode .
.TP
.BR --dna-root " " \fIPATH\fR
Root for DNA outputs (.dna).
Default:
.IR /gpfs/Log/qr_proto/dna .
.TP
.BR --protein-root " " \fIPATH\fR
Root for protein outputs (.protein).
Default:
.IR ./protein .
.TP
.BR --recipe-root " " \fIPATH\fR
Root for recipe JSON outputs.
Default:
.IR ./recipe .
.TP
.BR --log-dir " " \fIDIR\fR
Directory for logs.
Default:
.IR ./log .
.TP
.BR --chunk-size " " \fIN\fR
Block size in bytes (<=1024 recommended).
Default: 1024.
.TP
.BR --file-workers " " \fIN\fR
Number of source files processed concurrently.
Default: 4.
.TP
.BR --modality-workers " " \fIN\fR
Number of parallel workers for block write and modality generation.
Default: 8.
.TP
.BR --qr-version " " \fIN\fR
QR code version (1\-40).
Default: 40.
.TP
.BR --qr-ecc " " \fIL|M|Q|H\fR
QR error correction level.
Default: H.
.TP
.BR --no-qr
Disable QR code modality.
.TP
.BR --no-dna
Disable DNA modality.
.TP
.BR --no-protein
Disable protein modality.
.TP
.BR --verbose
Enable more chatty console logging.

.SH OUTPUT
.IP \(bu 2
.B .block
files stored under
.B --blocks-root .
.IP \(bu 2
Optional modality files (.svg, .dna, .protein) under their respective roots unless disabled.
.IP \(bu 2
Per\-file JSON
.B .recipe
with:
.RS
.IP \(bu 2
Block entries: sequence number + SHA\-256 value only.
.IP \(bu 2
Global
.B modality_options
: flags and root paths for modalities.
.RE
.IP \(bu 2
Logs written to
.B --log-dir .

.SH EXAMPLES
Run with all modalities enabled:
.PP
.EX
$ python3 da_dataset_prep.py \\
    --input-root ./source \\
    --blocks-root ./blocks \\
    --recipe-root ./recipe \\
    --file-workers 6 --modality-workers 16 --chunk-size 1024 --qr-version 40 --qr-ecc H
.EE
.PP
Blocks only (no QR/DNA/Protein):
.PP
.EX
$ python3 da_dataset_prep.py --no-qr --no-dna --no-protein
.EE

.SH EXIT STATUS
.TP
0
Program completed successfully.
.TP
1
Fatal error occurred.

.SH SEE ALSO
.BR da_recipe_dedupe_report (1)

.SH AUTHOR
Written by Carl (Digital Alexandria project).
Licensed under Creative Commons Attribution\-ShareAlike 4.0 (CC BY\-SA 4.0).
